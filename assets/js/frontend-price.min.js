!function(e){"use strict";e(document).ready((function(){e(document).on("viwebpos_get_price_html",(function(t,o,i=null,_=null,r=null,c=null,n=null){o=parseFloat(o||0),i=null!==i?i:e(document).triggerHandler("viwebpos_get_price_html_decimals",[viwebpos_price.wc_get_price_decimals,n])??viwebpos_price.wc_get_price_decimals,_=null!==_?_:viwebpos_price.wc_price_decimal_separator,r=null!==r?r:viwebpos_price.wc_price_thousand_separator;let a=viwebpos_format_number(Math.abs(o),i,_,r);c=c||e(document).triggerHandler("viwebpos_get_price_html_format",[viwebpos_price.wc_price_format,n])||viwebpos_price.wc_price_format,n=n||viwebpos_price.wc_currency_symbol;let p=c.replace("%2$s",a).replace("%1$s",n);return o<0?"-"+p:p})),e(document).on("viwebpos_calc_inclusive_tax",(function(t,o,i){let _={},r={},c={};e.each(i,(function(e,t){_[e]=0,"yes"===t.compound?r[e]=t.rate:c[e]=t.rate}));let n=o;if(Object.keys(r).length){let t=Object.keys(r).reverse();e.each(t,(function(e,t){let o=n-n/(1+r[t]/100);_[t]+=o,n-=o}))}if(Object.keys(c).length){let t=1+Object.values(c).reduce(((e,t)=>e+t))/100;e.each(c,(function(e,i){let r=o-(o-i/100/t*n);_[e]+=r}))}return e.each(_,(function(e,t){_[e]=viwebpos_round(t,0)})),_})),e(document).on("viwebpos_calc_exclusive_tax",(function(t,o,i){let _={};if(Object.keys(i).length){e.each(i,(function(e,t){if("yes"===t.compound)return!0;let i=o*t.rate/100;_[e]?_[e]+=i:_[e]=i}));let t=Object.keys(_).length?Object.values(_).reduce(((e,t)=>e+t)):0;e.each(i,(function(e,i){if("no"===i.compound)return!0;let r=(o+t)*i.rate/100;_[e]?_[e]+=r:_[e]=r,t=Object.values(_).reduce(((e,t)=>e+t))}))}return e.each(_,(function(e,t){_[e]=viwebpos_round(t,viwebpos_price.wc_get_rounding_precision)})),_})),e(document).on("viwebpos_get_matched_tax_rates",(function(t,o,i,_,r,c){viwebpos_price.viwebpos_taxes||(viwebpos_price.viwebpos_taxes={});let n={},a=[];return e.each(viwebpos_price.wc_tax_rates[c],(function(t,c){if(-1!==a.indexOf(c.tax_rate_priority))return!0;if(c.tax_rate_country&&c.tax_rate_country!==o.toUpperCase())return!0;if(c.tax_rate_state&&c.tax_rate_state!==i.toUpperCase())return!0;if(c.postcode_count){let t=!0;if(e.each(c.postcode,(function(e,o){if(-1!==_.indexOf(o))return t=!1,!1})),t)return!0}if(c.city_count&&-1===c.city.indexOf(r.toUpperCase()))return!0;n[c.tax_rate_id]={rate:parseFloat(c.tax_rate),label:c.tax_rate_name,shipping:parseInt(c.tax_rate_shipping)?"yes":"no",compound:parseInt(c.tax_rate_compound)?"yes":"no"},a.push(c.tax_rate_priority)})),viwebpos_price.viwebpos_taxes[c]=n,n})),e(document.body).on("viwebpos_apply_coupon",(function(e,t,o,i,_){return _&&viwebpos_price_obj["cart_apply_coupon_"+_]?viwebpos_price_obj["cart_apply_coupon_"+_](t,o,i):t}))})),window.viwebpos_price_obj={cart_apply_coupon_percent:function(t,o,i){if(!o||!i)return t;let _=0,r=0,c=0,n=!0;o.limit_usage_to_x_items&&(c=o.limit_usage_to_x_items);let a=parseFloat(o.amount),p=o.coupon_code;e.each(i,(function(i,s){let u=viwebpos_price_obj.get_discounted_price_in_cents(s,t),l=viwebpos_price.woocommerce_calc_discounts_sequentially?u:viwebpos_round(s.price),b=c&&c-0<s.quantity?c-0:s.quantity;b=Math.max(0,e(document.body).triggerHandler("viwebpos_woocommerce_coupon_get_apply_quantity",[b,s,o,t])||b),l=l/s.quantity*b;let d=Math.floor(l*a/100),w=e(document.body).triggerHandler("viwebpos_woocommerce_coupon_get_discount_amount",[viwebpos_price_obj.remove_number_precision(d),viwebpos_price_obj.remove_number_precision(l),s.object,!1,o]);void 0!==w&&(w=viwebpos_price_obj.add_number_precision(w),w!==d&&(d=w,n=!1)),d=viwebpos_round(Math.min(u,d),0),r+=l,_+=d,t[p][s.key]+=d}));let s=viwebpos_round(r*(a/100),2);return _<s&&n&&(t=viwebpos_price_obj.cart_apply_coupon_remainder(t,o,i,s-_)),t},cart_apply_coupon_fixed_product:function(t,o,i,_=null,r=!1){if(!o||!i)return t;let c=0,n=0,a=0,p=o.coupon_code;return _=_||viwebpos_price_obj.add_number_precision(o.amount),o.limit_usage_to_x_items&&(n=o.limit_usage_to_x_items),e.each(i,(function(i,r){let s=viwebpos_price_obj.get_discounted_price_in_cents(r,t),u=viwebpos_price.woocommerce_calc_discounts_sequentially?s:r.price,l=r.quantity,b=0;n?(l=n-a<l?n-a:l,l=Math.max(0,e(document.body).triggerHandler("viwebpos_woocommerce_coupon_get_apply_quantity",l,r,o,t)||l),b=Math.min(_,r.price/r.quantity)*l):(l=e(document.body).triggerHandler("viwebpos_woocommerce_coupon_get_apply_quantity",l,r,o,t)||l,b=l*_);let d=e(document.body).triggerHandler("viwebpos_woocommerce_coupon_get_discount_amount",[viwebpos_price_obj.remove_number_precision(b),viwebpos_price_obj.remove_number_precision(u),r.object,!1,o]);void 0!==d&&(b=viwebpos_price_obj.add_number_precision(d)),b=Math.min(s,b),c+=b,a+=l,t[p][r.key]+=b})),r?{total_discount:c,discounts:t}:t},cart_apply_coupon_fixed_cart:function(t,o,i,_=null){if(!o||!i)return t;let r=0,c=0;o.coupon_code;if(_=_||viwebpos_price_obj.add_number_precision(o.amount),i=i.filter((function(e){return viwebpos_price_obj.get_discounted_price_in_cents(e,t)>0})),e.each(i,(function(e,t){c+=t.quantity})),!c)return t;if(_){let e=Math.abs(parseInt(_/c));if(e>0){let c=viwebpos_price_obj.cart_apply_coupon_fixed_product(t,o,i,e,!0);c.total_discount&&(r=c.total_discount),c.discounts&&(t=c.discounts),r>0&&r<_&&(t=viwebpos_price_obj.cart_apply_coupon_fixed_cart(t,o,i,_-r))}else _>0&&(t=viwebpos_price_obj.cart_apply_coupon_remainder(t,o,i,_))}else t=viwebpos_price_obj.cart_apply_coupon_fixed_product(t,o,i,0);return t},cart_apply_coupon_custom:function(t,o,i){if(!o||!i)return t;let _=0,r=0,c=o.coupon_code;return o.limit_usage_to_x_items&&(_=o.limit_usage_to_x_items),e.each(i,(function(i,n){let a=viwebpos_price_obj.get_discounted_price_in_cents(n,t),p=viwebpos_price_obj.remove_number_precision(viwebpos_price.woocommerce_calc_discounts_sequentially?a:n.price),s=_&&_-r<n.quantity?_-r:n.quantity;s=Math.max(0,e(document.body).triggerHandler("viwebpos_woocommerce_coupon_get_apply_quantity",[s,n,o,t])||s);let u=viwebpos_price_obj.add_number_precision(e(document.body).triggerHandler("viwebpos_coupon_get_discount_amount",[o,p/n.quantity,n.object,!0]))*s;u=viwebpos_round(Math.min(a,u),0),r+=s,t[c][n.key]+=u})),t[c]=e(document.body).triggerHandler("viwebpos_woocommerce_coupon_custom_discounts_array",[t[c],o,viwebpos_data])||t[c],t},cart_apply_coupon_remainder:function(t,o,i,_){if(!o||!i)return t;let r=0;return e.each(i,(function(e,i){for(let e=0;e<i.quantity;e++){let e=viwebpos_price_obj.get_discounted_price_in_cents(i,t),c=Math.min(e,1);if(r+=c,t[o.coupon_code][i.key]+=c,r>=_)break}if(r>=_)return!1})),t},cart_get_discounts_by_coupon:function(t,o=!1){if(!t)return 0;let i={};return e.each(t,(function(e,t){i[e]=Object.values(t).reduce(((e,t)=>(parseFloat(e)||0)+(parseFloat(t)||0)))})),o?i:viwebpos_price_obj.remove_number_precision_deep(i)},cart_get_tax_class_costs:function(t,o,i){let _,r={},c={},n={},a={};return e.each(t,(function(e,t){c[e]=t.tax_class,a[e]=t})),e.each(o,(function(e,t){c[e]=t.tax_class,a[e]=t})),e.each(i,(function(e,t){c[e]=t.tax_class,a[e]=t})),e.each(c,(function(e,t){n[t]=0})),_=Object.keys(c)[0]||"",n["non-taxable"]=0,e.each(a,(function(e,t){let o=parseFloat(t.total);if(0>o)return!0;t.taxable?"inherit"===t.tax_class?n[_]+=o:n[t.tax_class]+=o:n["non-taxable"]+=o})),e.each(n,(function(e,t){t>0&&(r[e]=t)})),r},get_discounted_price_in_cents:function(e,t){if(!e)return 0;let o=0;return t&&Object.keys(t).length&&(o=viwebpos_price_obj.get_discounts_by_item(t,!0),o=o[e.key]?o[e.key]:0),Math.abs(viwebpos_round(e.price-o))},get_discounts_by_item:function(t,o=!1){if(!t)return{};let i={};return e.each(t,(function(t,o){e.each(o,(function(e,t){i[e]||(i[e]=0),i[e]+=t}))})),o?i:viwebpos_price_obj.remove_number_precision_deep(i)},adjust_non_base_location_price:function(t){if(t.price_includes_tax&&t.taxable){let o=viwebpos_price_obj.get_base_tax_rates(t.product.base_tax_class||""),i=Object.keys(o),_=!0;for(let e of i)if(!t.tax_rates[e]){_=!1;break}if(!_){let i=e(document).triggerHandler("viwebpos_calc_inclusive_tax",[t.price,o]),_=0;Object.keys(i).length&&(_=Object.values(i).reduce(((e,t)=>e+t)));let r=e(document).triggerHandler("viwebpos_calc_inclusive_tax",[t.price-_,t.tax_rates]),c=0;Object.keys(r).length&&(c=Object.values(r).reduce(((e,t)=>e+t))),t.price=t.price-_+c}}return t},get_base_tax_rates:function(t=""){let o=viwebpos_price.shop_address;return e(document).triggerHandler("viwebpos_get_matched_tax_rates",[o.country,o.state,o.postcode,o.city,t])},remove_number_precision:function(e){return e/Math.pow(10,viwebpos_price.wc_get_price_decimals)},remove_number_precision_deep:function(t){return"object"!=typeof t?viwebpos_price_obj.remove_number_precision(parseFloat(t??0)):(e.each(t,(function(e,o){t[e]=viwebpos_price_obj.remove_number_precision_deep(o)})),t)},add_number_precision:function(e,t=!0){return e*=Math.pow(10,viwebpos_price.wc_get_price_decimals),t?viwebpos_round(e,viwebpos_price.wc_get_rounding_precision-viwebpos_price.wc_get_price_decimals):e},add_number_precision_deep:function(t,o=!0){return"object"!=typeof t?viwebpos_price_obj.add_number_precision(parseFloat(t??0),o):(e.each(t,(function(e,i){t[e]=viwebpos_price_obj.add_number_precision_deep(i,o)})),t)},array_merge_recursive_numeric:function(t){if("object"!=typeof t)return{};if(1===t.length)return t[0];e.each(t,(function(e,o){"object"!=typeof o&&delete t[e]}));let o=t.pop();return e.each(t,(function(t,i){e.each(o,(function(e,t){void 0!==i[e]&&(isNaN(t)||isNaN(i[e])?"object"==typeof t&&"object"==typeof i[e]?o[e]=viwebpos_price_obj.array_merge_recursive_numeric([t,i[e]]):o[e]=i[e]:o[e]=parseFloat(t)+parseFloat(i[e]))})),e.each(i,(function(e,t){void 0===o[e]&&(o[e]=t)}))})),o}},window.viwebpos_get_price_html=function(t,o=null,i=null,_=null,r=null,c=null){return e(document).triggerHandler("viwebpos_get_price_html",[t,o,i,_,r,c])},window.viwebpos_format_number=function(e,t=null,o=null,i=null){if(t=parseInt(t),e=(e=parseFloat(e||0)).toFixed(t).toString(),!t)return e.replace(/\B(?=(?:\d{3})+(?!\d))/g,i);let _=e.substring(0,e.length-t-1);return _=_.replace(/\B(?=(?:\d{3})+(?!\d))/g,i),e=_+o+e.substring(e.length-t)},window.viwebpos_round=function(e,t=""){return t=""===t?viwebpos_price.wc_get_price_decimals:t,Math.round(e*Math.pow(10,t))/Math.pow(10,t)},window.viwebpos_get_product_price_including_tax=function(t,o="",i=""){if(i=""!==i?Math.max(0,parseFloat(i)):t.price,o=o?Math.max(0,parseFloat(o)):1,""===i||o<=0)return 0;let _=i*o,r=_;if(!t.taxable)return r;let c,n=void 0!==viwebpos_data.current_cart.shop_address?viwebpos_data.current_cart.shop_address:viwebpos_price.shop_address,a=e(document).triggerHandler("viwebpos_get_matched_tax_rates",[n.country,n.state,n.postcode,n.city,t.tax_class||""]);if(viwebpos_price.product_price_includes_tax){n=viwebpos_price.shop_address;let o=e(document).triggerHandler("viwebpos_get_matched_tax_rates",[n.country,n.state,n.postcode,n.city,t.base_tax_class||""]),i=Object.keys(o),c=!0;for(let e of i)if(!a[e]){c=!1;break}if(!c){let t=e(document).triggerHandler("viwebpos_calc_inclusive_tax",[_,o]),i=0,c=0;Object.keys(t).length&&(i=Object.values(t).reduce(((e,t)=>e+t)),c=Object.values(t).reduce(((e,t)=>viwebpos_price.wc_tax_round_at_subtotal?e+t:viwebpos_round(e)+viwebpos_round(t))));let n=e(document).triggerHandler("viwebpos_calc_inclusive_tax",[_-i,a]),p=0;Object.keys(n).length&&(p=Object.values(n).reduce(((e,t)=>viwebpos_price.wc_tax_round_at_subtotal?e+t:viwebpos_round(e)+viwebpos_round(t)))),r=viwebpos_round(r-c+p)}}else c=e(document).triggerHandler("viwebpos_calc_exclusive_tax",[_,a]),Object.values(c).length&&(r+=Object.values(c).reduce(((e,t)=>e+t)));return r},window.viwebpos_get_product_price_excluding_tax=function(t,o="",i=""){if(i=""!==i?Math.max(0,parseFloat(i)):t.price,o=o?Math.max(0,parseFloat(o)):1,""===i||o<=0)return 0;let _=i*o,r=_;if(t.taxable&&viwebpos_price.product_price_includes_tax){let o=viwebpos_price.shop_address,i=e(document).triggerHandler("viwebpos_get_matched_tax_rates",[o.country,o.state,o.postcode,o.city,t.tax_class||""]),c=e(document).triggerHandler("viwebpos_calc_inclusive_tax",[_,i]);Object.values(c).length&&(r-=Object.values(c).reduce(((e,t)=>e+t)))}return r},window.viwebpos_get_product_price=function(e,t="",o=""){let i;return i=viwebpos_price.pd_display_prices_including_tax?viwebpos_get_product_price_including_tax(e,t,o):viwebpos_get_product_price_excluding_tax(e,t,o),viwebpos_get_price_html(i)}}(jQuery);