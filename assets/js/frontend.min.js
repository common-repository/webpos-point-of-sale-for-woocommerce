!function(e){"use strict";let o,p=e(window).width()<821;e(window).on("resize",(function(){let t=e(window).width()<821;t!==p&&(p=t,e(document.body).trigger("viwebpos-frontend-load",o))})),e(document).ready((function(e){e(".vi-ui.dropdown").off().dropdown(),e(document.body).on("viwebpos_get_popup_wrap",(function(o,t=""){if(!t||e(".viwebpos-popup-wrap-"+t).length)return!1;let i='<div class="viwebpos-popup-wrap viwebpos-popup-wrap-'+t+'">';switch(i+='<div class="viwebpos-popup"><div class="viwebpos-overlay viwebpos-overlay-loading"></div><div class="viwebpos-overlay"></div>',i+='<div class="viwebpos-popup-container-wrap"><span class="viwebpos-popup-close">&#43;</span>',i+='<div class="viwebpos-popup-container">',i+='<div class="viwebpos-popup-header-wrap">',t){case"add-product":i+=viwebpos.custom_product_title;break;case"add-customer":i+=viwebpos.add_new_customer;break;case"print-receipt":i+=viwebpos.print_title;break;case"add-transaction":i+=viwebpos.transaction_add_title;break;case"settings-pos":i+=viwebpos_text.settings_title}switch(i+="</div>",i+='<div class="viwebpos-popup-content-wrap">',t){case"add-product":i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-horizontal viwebpos-popup-content-full-row viwebpos-popup-content-add-product-name">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.custom_product_name_title+"</div>",i+='<div class="viwebpos-popup-content-value">',i+='<input type="text" class="viwebpos-custom-product-name" placeholder="'+viwebpos.custom_product_name_placeholder+'" data-value_default="" value="">',i+="</div></div></div>",i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-horizontal viwebpos-popup-content-full-row viwebpos-popup-content-add-product-price">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.custom_product_price_title+"</div>",i+='<div class="viwebpos-popup-content-value">',i+=viwebpos.custom_product_price_value,i+="</div></div></div>",i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-horizontal viwebpos-popup-content-full-row viwebpos-popup-content-add-product-qty">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.custom_product_qty_title+"</div>",i+='<div class="viwebpos-popup-content-value">',i+='<div class="viwebpos-popup-add-product-qty-wrap viwebpos-product-qty-wrap">',i+='<span class="viwebpos-product-qty-action viwebpos-product-qty-minus viwebpos-popup-add-product-qty-action viwebpos-popup-add-product-qty-minus"> <i class="icon minus"></i></span>',i+='<input type="number" name="quantity" data-value_default="1" min="1" step="1" value="1" class="viwebpos-product-qty-value custom_product_qty">',i+='<span class="viwebpos-product-qty-action viwebpos-product-qty-plus viwebpos-popup-add-product-qty-action viwebpos-popup-add-product-qty-plus"> <i class="icon plus"></i></span>',i+="</div></div></div></div>";break;case"add-customer":let o=viwebpos_price.shop_address.country||"";i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-half-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_first_name+"</div>",i+='<div class="viwebpos-popup-content-value"><input type="text" class="viwebpos-add-customer-first-name" data-value_default="" value=""></div>',i+="</div>",i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-half-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_last_name+"</div>",i+='<div class="viwebpos-popup-content-value"><input type="text" class="viwebpos-add-customer-last-name" data-value_default="" value=""></div>',i+="</div></div>",i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-half-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_email+"</div>",i+='<div class="viwebpos-popup-content-value"><input type="text" class="viwebpos-add-customer-email" data-value_default="" value=""></div>',i+="</div>",i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-half-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_phone+"</div>",i+='<div class="viwebpos-popup-content-value"><input type="text" class="viwebpos-add-customer-phone" data-value_default="" value=""></div>',i+="</div></div>",i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-full-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_address1+"</div>",i+='<div class="viwebpos-popup-content-value"><input type="text" class="viwebpos-add-customer-address1" data-value_default="" value=""></div>',i+="</div></div>",i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-half-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_country+"</div>",i+='<div class="viwebpos-popup-content-value">',i+='<select class="viwebpos-add-customer-country vi-ui fluid search dropdown" data-value_default="'+o+'" ><option value="">'+viwebpos.customer_country_select+"</option>",e.each(viwebpos.wc_countries,(function(e,o){i+='<option value="'+e+'" >'+o+"</option>"})),i+="</select>",i+="</div></div>",i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-half-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_state+"</div>",i+='<div class="viwebpos-popup-content-value"><input type="text" class="viwebpos-add-customer-state" data-value_default="" value=""></div>',i+="</div></div>",i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-half-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_city+"</div>",i+='<div class="viwebpos-popup-content-value"><input type="text" class="viwebpos-add-customer-city" data-value_default="" value=""></div>',i+="</div>",i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-half-row">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.customer_postcode+"</div>",i+='<div class="viwebpos-popup-content-value"><input type="text" class="viwebpos-add-customer-postcode" data-value_default="" value=""></div>',i+="</div></div>";break;case"print-receipt":i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-vertical viwebpos-popup-content-full-row">',i+='<input type="hidden" class="viwebpos-print-receipt-order" data-value_default="" value="">',i+='<div class="viwebpos-popup-content-value"></div>',i+="</div></div>";break;case"add-transaction":i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-horizontal viwebpos-popup-content-full-row viwebpos-popup-content-add-transaction-type">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.transaction_add_type_title+"</div>",i+='<div class="viwebpos-popup-content-value">',i+='<div class="vi-ui radio checkbox">',i+='<input type="radio" value="in" name="new-transaction-type" class="viwebpos-popup-content-add-transaction-type-value" id="viwebpos-popup-content-add-transaction-type-in" checked>',i+='<label for="viwebpos-popup-content-add-transaction-type-in">'+viwebpos.transaction_add_type_in+"</label>",i+="</div>",i+='<div class="vi-ui radio checkbox">',i+='<input type="radio" value="out" name="new-transaction-type" class="viwebpos-popup-content-add-transaction-type-value" id="viwebpos-popup-content-add-transaction-type-out">',i+='<label for="viwebpos-popup-content-add-transaction-type-out">'+viwebpos.transaction_add_type_out+"</label>",i+="</div>",i+="</div></div></div>",i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-horizontal viwebpos-popup-content-full-row viwebpos-popup-content-add-transaction-price">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.transaction_add_price_title+"</div>",i+='<div class="viwebpos-popup-content-value">',i+=viwebpos.transaction_add_price_value,i+="</div></div></div>",i+='<div class="viwebpos-popup-content">',i+='<div class="viwebpos-popup-content-horizontal viwebpos-popup-content-full-row viwebpos-popup-content-add-transaction-reason">',i+='<div class="viwebpos-popup-content-title">'+viwebpos.transaction_add_reason_title+"</div>",i+='<div class="viwebpos-popup-content-value">',i+='<textarea rows="4" cols="40" class="viwebpos-popup-content-add-transaction-reason-value"></textarea>',i+="</div></div></div>";break;case"settings-pos":let t=viwebpos_text.settings_default;e.each(t,(function(o,t){if(i+='<div class="viwebpos-popup-content">',i+=`<div class="viwebpos-popup-content-${p?"vertical":"horizontal"} viwebpos-popup-content-full-row viwebpos-settings-pos-${o}">`,i+=`<div class="viwebpos-popup-content-title">${t.title||t}</div>`,i+='<div class="viwebpos-popup-content-value">',"object"!=typeof t)i+=`<div class="vi-ui toggle checkbox"><input type="checkbox" data-name="${o}" class="viwebpos-settings-pos-${o}-checkbox"><label></label></div>`;else{let p=t.multi?"multiple":"";i+=`<select class="viwebpos-popup-setting-${o} ${p?"viwebpos-popup-setting-multi":""} vi-ui fluid search dropdown" data-name="${o}" ${p}>`,e.each(t.info,(function(e,o){i+=`<option value="${e}">${o}</option>`})),i+="</select>"}i+="</div></div></div>"}))}switch(i+="</div>",i+='<div class="viwebpos-popup-footer-wrap">',t){case"add-product":i+='<button class="vi-ui button teal viwebpos-popup-bt viwebpos-popup-bt-'+t+'">'+viwebpos.custom_product_atc_title+"</button>";break;case"add-customer":i+='<button class="vi-ui button teal viwebpos-popup-bt viwebpos-popup-bt-'+t+'">'+viwebpos.add_new_customer_bt+"</button>";break;case"print-receipt":i+='<button class="vi-ui button teal viwebpos-popup-bt viwebpos-popup-bt-'+t+'">'+viwebpos.print_button_title+"</button>";break;case"add-transaction":i+='<button class="vi-ui button teal viwebpos-popup-bt viwebpos-popup-bt-'+t+'">'+viwebpos.transaction_add_bt_title+"</button>"}if(i+="</div>",i+="</div></div></div></div>",e(".viwebpos-container-wrap").append(i),"add-customer"===t)e(".viwebpos-popup-wrap-add-customer .viwebpos-add-customer-country").dropdown("set selected",viwebpos_price.shop_address.country||"");else e(".viwebpos-popup-wrap-"+t).find("select.vi-ui.dropdown").length&&e(".viwebpos-popup-wrap-"+t).find("select.vi-ui.dropdown").off().dropdown()})),e(document).on("click",".viwebpos-wrap a, .viwebpos-wrap .viwebpos-url",(function(o){if(e(this).hasClass("viwebpos-menu-item-logout"))return!!confirm(viwebpos.logout_message)||(o.preventDefault(),o.stopPropagation(),!1);if(e(this).hasClass("viwebpos-menu-item-settings"))return o.preventDefault(),o.stopPropagation(),e(".viwebpos-popup-wrap-settings-pos").removeClass("viwebpos-popup-wrap-hidden").addClass("viwebpos-popup-wrap-show"),!0;if(e(this).hasClass("viwebpos-menu-item-refresh_database")){o.preventDefault(),o.stopPropagation();let e=viwebpos_data.viwebposDB.result;return viwebpos_data.delete(e.transaction("settings","readwrite").objectStore("settings"),"data_prefix"),location.reload(),!0}if(e(this).hasClass("viwebpos-menu-item-my-account"))return!0;let p=e(this).attr("href")||e(this).data("href"),t=window.location.pathname;o.preventDefault(),o.stopPropagation();let i=e(document.body).triggerHandler("viwebpos-get-current-url",[e(this),p]);if(void 0!==i&&(p=i),!p||"#"===p||t===p)return!1;let s="bill-of-sale",a="";if(viwebpos.pos_pathname.includes("?")||p.includes("?")){let e=p.split("?")[0],o=viwebpos.pos_pathname.split("?")[0];a=e.replace(o,""),a===e&&(a=decodeURIComponent(e).replace(o,""))}else a=p.replace(viwebpos.pos_pathname,""),a===p&&(a=decodeURIComponent(p).replace(viwebpos.pos_pathname,""));a&&"/"!==a&&(a.indexOf("?")>0&&(a=a.substring(0,a.indexOf("?"))),a=0===a.indexOf("/")?a.substring(1).split("/"):a.split("/"),s=a[0]?a[0]:s),window.history.pushState({page:s},"",p),window.history.replaceState({page:s},"",p),e(document.body).trigger("viwebpos-frontend-load",[s])})),e(document.body).on("viwebpos_popup_close",(function(){e(".viwebpos-popup-wrap.viwebpos-popup-wrap-show").each((function(o,p){e(p).find(".viwebpos-popup-close").trigger("click")}))})),e(document).on("click",".viwebpos-popup-close, .viwebpos-overlay:not(.viwebpos-overlay-loading)",(function(o){let p=e(this).closest(".viwebpos-popup-wrap");if(p.hasClass("viwebpos-popup-wrap-not-close"))return!1;p.hasClass("viwebpos-popup-wrap-show")&&(p.removeClass("viwebpos-popup-wrap-show").addClass("viwebpos-popup-wrap-hidden"),p.find(".viwebpos-popup-content-value-error").removeClass("viwebpos-popup-content-value-error"),p.find(".viwebpos-popup-bt-loading").removeClass("viwebpos-popup-bt-loading")),e(document.body).trigger("viwebpos_popup_after_close",[p])})),e(document).on("blur change",'input[type = "number"]',(function(){if(!e(this).val())return!1;let o,p=parseFloat(e(this).attr("min"))||0,t=parseFloat(e(this).attr("max")),i=parseFloat(e(this).val()),s=e(this).data("can_reset")||"";if(o=i,p>i&&(o=s?"":p),t&&t<i){if(e(this).hasClass("viwebpos-cart-item-qty"))return!1;o=s?"":t}e(this).val(o)})),e(document).on("keydown",(function(o){let p=o.which||o.keyCode;if(e.inArray(p,[113,114,115,117,118,119,120,121,38,40,27,13])<0)return!0;if(13===p&&(e(".viwebpos-popup-wrap-add-customer.viwebpos-popup-wrap-show").length||e(".viwebpos-customer-manage-wrap").length))return o.preventDefault(),o.stopPropagation(),e(".viwebpos-customer-manage-wrap").length?e(".viwebpos-customer-manage-wrap").find(".viwebpos-customer-submit").trigger("click"):e(".viwebpos-popup-wrap-add-customer.viwebpos-popup-wrap-show").find(".viwebpos-popup-bt").trigger("click"),!1;if(13===p&&!e(".viwebpos-checkout-form-content-paid-input:not(.viwebpos-checkout-form-content-amount-input):focus").length)return!0;if((38===p||40===p)&&(e(".viwebpos-popup-wrap-show").length||e(".viwebpos-checkout-form-container input:focus").length))return!0;switch(o.preventDefault(),o.stopPropagation(),p){case 38:if(e(":hover").closest(".viwebpos-cart-item-wrap").length){let o=e(":hover").closest(".viwebpos-cart-item-wrap");o.hasClass("viwebpos-cart-item-wrap-note")&&(o=o.prev(".viwebpos-cart-item-wrap"));let p=o.find(".viwebpos-cart-item-qty");p.val(parseInt(p.val()||0)+1).trigger("change")}break;case 40:if(e(":hover").closest(".viwebpos-cart-item-wrap").length){let o=e(":hover").closest(".viwebpos-cart-item-wrap");o.hasClass("viwebpos-cart-item-wrap-note")&&(o=o.prev(".viwebpos-cart-item-wrap"));let p=o.find(".viwebpos-cart-item-qty");p.val(parseInt(p.val()||0)-1).trigger("change")}break;case 113:if(e(".viwebpos-popup-wrap-show").length)break;e(".viwebpos-add-custom-product-wrap").trigger("click");break;case 114:if(e(".viwebpos-popup-wrap-show").length)break;e(".viwebpos-add-customer-wrap").length?e(".viwebpos-add-customer-wrap").trigger("click"):e(".viwebpos-checkout-form-customer-search-icon").trigger("click");break;case 115:if(e(".viwebpos-popup-wrap-show").length)break;e(".viwebpos-checkout-form-footer-coupon:not(.viwebpos-hidden)").trigger("click");break;case 117:if(e(".viwebpos-popup-wrap-show").length)break;e(".viwebpos-search-product").trigger("focus");break;case 118:if(e(".viwebpos-popup-wrap-show").length)break;e(".viwebpos-search-customer, .viwebpos-checkout-search-customer").trigger("focus");break;case 119:if(e(".viwebpos-popup-wrap-show").length)break;e(".viwebpos-checkout-form-content-wrap-payment").length?e(".viwebpos-checkout-form-content-wrap-payment").hasClass("viwebpos-hidden")?e(".viwebpos-checkout-form-content-wrap-total .viwebpos-checkout-form-content-paid1 .viwebpos-checkout-form-content-paid1-info").length<2?e(".viwebpos-checkout-form-content-paid-input:not(.viwebpos-checkout-form-content-amount-input)").trigger("focus"):e(".viwebpos-checkout-form-footer-payment").trigger("click"):e(".viwebpos-checkout-form-content-amount-input.viwebpos-checkout-form-content-paid-input").trigger("focus"):e(".viwebpos-checkout-form-content-paid-input:not(.viwebpos-checkout-form-content-amount-input)").trigger("focus");break;case 120:e(".viwebpos-popup-wrap-show").length||e(".viwebpos-checkout-form-footer-payment").trigger("click");break;case 121:if(e(".viwebpos-popup-wrap-show").length)break;e(".viwebpos-checkout-form-footer-checkout-wrap").trigger("click");break;case 13:if(e(".viwebpos-popup-wrap-show").length)break;e(".viwebpos-checkout-form-content-paid-input:focus").addClass("viwebpos-checkout-form-content-paid-input-checkout_after_change");break;default:e(document.body).trigger("viwebpos_popup_close")}})),e(document.body).on("viwebpos-frontend-load",(function(t,i=""){switch(o=i||(viwebpos.page_request[1]||""),e(".viwebpos-wrap").addClass("viwebpos-wrap-loading"),p?e(".viwebpos-wrap").addClass("viwebpos-wrap-mobile"):e(".viwebpos-wrap").removeClass("viwebpos-wrap-mobile"),e(".viwebpos-container-wrap, .viwebpos-header-search-wrap").html(null),e(document.body).trigger("viwebpos-frontend-before-load",o),o){case"orders":case"transactions":case"customers":e(document.body).trigger("viwebpos-"+o+"-load"),e(".viwebpos-menu-item-settings").addClass("viwebpos-hidden");break;default:o&&"bill-of-sale"!==o&&e(document.body).triggerHandler("viwebpos-"+o+"-load")||(e(document.body).trigger("viwebpos-bill-of-sale-load"),e(".viwebpos-menu-item-settings").removeClass("viwebpos-hidden"))}})),e(document.body).on("viwebpos-frontend-loaded",(function(o,t=""){if(e(".viwebpos-header-right-wrap").find(".viwebpos-mobile-icon").remove(),p&&-1===["transactions"].indexOf(t)){let o="customers"===t?"":'<div class="viwebpos-mobile-icon-show viwebpos-mobile-icon"><i class="shopping cart icon"></i></div>';o+='<div class="viwebpos-mobile-icon-back viwebpos-mobile-icon viwebpos-hidden"><i class="reply all icon"></i></div>',e(".viwebpos-container-element > div").eq(1).addClass("viwebpos-mobile-container"),e(".viwebpos-header-right-wrap").append(e(document).triggerHandler("viwebpos_get_mobile_icon_html",[o,t])||o)}})),e(document.body).on("viwebpos-mobile-show-content",(function(o,p){e(".viwebpos-mobile-container").toggleClass("viwebpos-mobile-container-show"),e(".viwebpos-mobile-icon").toggleClass("viwebpos-hidden")})),e(document).on("click",".viwebpos-mobile-icon, .viwebpos-wrap-mobile .viwebpos-add-customer-wrap",(function(){if(e(this).hasClass("viwebpos-add-customer-wrap")&&e(".viwebpos-mobile-container-show").length)return!0;e(document.body).trigger("viwebpos-mobile-show-content",[e(this)])}))})),e(window).on("popstate",(function(o){let p;if(window.history.state&&(p=window.history.state.page||""),!p){let e=viwebpos.pos_pathname.includes("://")?window.location.href:window.location.pathname,o="";if(p="bill-of-sale",viwebpos.pos_pathname.includes("?")||e.includes("?")){let p=e.split("?")[0],t=viwebpos.pos_pathname.split("?")[0];o=p.replace(t,""),o===p&&(o=decodeURIComponent(p).replace(t,""))}else o=e.replace(viwebpos.pos_pathname,""),o===e&&(o=decodeURIComponent(e).replace(viwebpos.pos_pathname,""));o&&"/"!==o&&(o.indexOf("?")>0&&(o=o.substring(0,o.indexOf("?"))),o=0===o.indexOf("/")?o.substring(1).split("/"):o.split("/"),p=o[0]?o[0]:p)}e(document.body).trigger("viwebpos-frontend-load",[p])})),window.viwebpos_ajax=function(o){let p=e(document).triggerHandler("viwebpos_ajax_get_custom_options",[o]);p&&p.url&&o.type&&o.data&&p.success&&(o=p),fetch(o.url,{method:o.type,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:o.data}).then((e=>e.ok?e.json():e.text().then((o=>{throw{statusText:e.statusText,responseText:o}})))).then(o.success).catch((e=>o.error&&o.error(e))).finally((()=>o.complete&&o.complete()))}}(jQuery);