jQuery(document).ready((function(e){"use strict";let s,t=viwebpos.wc_states||"";function o(s,t=1,o="",i=!1){e(".viwebpos-wrap").removeClass("viwebpos-wrap-loading");let a=e(".viwebpos-customers-container"),r=e(".viwebpos-customer-manage-wrap"),c=e(".viwebpos-customers-list"),n=e(".viwebpos-search-input.viwebpos-search-customer"),d="",l=!1;if(c.length||(e(".viwebpos-customers-list-wrap").prepend('<div class="viwebpos-customers-list"></div>'),c=e(".viwebpos-customers-list")),a.find(".viwebpos-search-customer-more").remove(),1!==t||i||(c.html(""),r.data("id","").find(".viwebpos-customer-fname"),r.find(".viwebpos-customer-fname").val("").removeClass("viwebpos-content-value-error"),r.find(".viwebpos-customer-lname").val("").removeClass("viwebpos-content-value-error"),r.find(".viwebpos-customer-email").val("").removeClass("viwebpos-content-value-error"),r.find(".viwebpos-customer-phone").val("").removeClass("viwebpos-content-value-error"),r.find(".viwebpos-customer-address1").val(""),r.find(".viwebpos-customer-address2").val(""),r.find(".viwebpos-customer-country").val(""),r.find(".viwebpos-customer-state").val(""),r.find(".viwebpos-customer-city").val(""),r.find(".viwebpos-customer-postcode").val("")),s){if(s.length&&s.at(-1).next_page&&(l=s.at(-1).next_page,n.data("page",l),s.pop()),e.each(s,(function(e,s){i||(d=""),d+='<div class="viwebpos-search-customer-row" data-id="'+s.id+'">',d+='<div class="viwebpos-search-customer-line" >',d+='<div class="viwebpos-search-customer-image"><img src="'+s.avatar_url+'" alt="'+s.user_name+'"></div>',d+='<div class="viwebpos-search-customer-detail">',d+='<div class="viwebpos-search-customer-name"><span>'+s.first_name+"</span> <span>"+s.last_name+"</span> </div>",null!=s.email&&(d+='<div class="viwebpos-search-customer-email"><span><i class="envelope outline icon"></i></span><span>'+s.email+"</span></div>"),s.phone.length&&(d+='<div class="viwebpos-search-customer-phone"><span><i class="phone icon"></i></span><span>'+s.phone+"</span></div>"),d+="</div>",d+='<div class="viwebpos-customer-arrow"><i class="angle right icon"></i></div>',d+="</div>",d+="</div>",i||c.append(d)})),i&&c.append(d),l){let e='<div class="viwebpos-search-customer-more"><span class="vi-ui teal button">'+(viwebpos.load_more_title||"Load more")+"</span></div>";c.append(e)}d||c.html('<div class="viwebpos-search-customer-empty">'+(viwebpos.search_customer_empty||"No customer found")+"</div>")}else c.html('<div class="viwebpos-search-customer-empty">'+(viwebpos.search_customer_empty||"No customer found")+"</div>")}e(document.body).on("viwebpos_customer_state_init",(function(s,o,i,a="",r=""){if(i=e(i),!o||!t)return i.replaceWith(a),!1;let c,n=a,d=!1;t[o]&&(c=t[o],c&&Object.keys(c).length?(d=!0,n='<select class="vi-ui fluid search dropdown viwebpos-customer-search-state '+e(a).attr("class")+'"><option value="">'+viwebpos.customer_country_select+"</option>",e.each(c,(function(e,s){n+='<option value="'+e+'" >'+s+"</option>"})),n+="</select>"):n='<input type="text" class="'+e(a).attr("class")+'" value="" disabled>'),i.replaceWith(n),d&&e(".vi-ui.dropdown.viwebpos-customer-search-state").dropdown("set selected",r)})),e(document.body).on("viwebpos_customer_fields_validate",(function(s,t,o=""){let i=[];if(!t||!Object.keys(t).length)return["Can not find fields to validate!"];let a=["customer_name"];if(a.indexOf("customer_name")>-1){if(!e(t.first_name).length||!e(t.last_name).length)return["Can not find fields to validate!"];if(!e(t.first_name).val()&&!e(t.last_name).val())return e(t.first_name).addClass(o),e(t.last_name).addClass(o),i.push(viwebpos.error_customer_name_empty),i}return-1!==a.indexOf("email")||e(document.body).triggerHandler("viwebpos_check_is_email",e(t.email).val())||(i.push(viwebpos.error_customer_invalid_email),e(t.email).addClass(o)),-1!==a.indexOf("phone")||e(document.body).triggerHandler("viwebpos_check_is_phone",e(t.phone).val())||(i.push(viwebpos.error_customer_invalid_phone),e(t.phone).addClass(o)),i})),e(document.body).on("viwebpos_check_is_email",(function(e,s=""){return!s||"string"==typeof s&&s.toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)})),e(document.body).on("viwebpos_check_is_phone",(function(e,s=""){return"string"==typeof s&&(!s||!s.replaceAll(/[\s\#0-9_\-\+\/\(\)\.]/gi,"").trim().length)})),e(document.body).on("viwebpos-customers-load",(function(){if(!e(".viwebpos-header-search-customer").length){let s='<div class="viwebpos-header-search viwebpos-header-search-customer">';e(".viwebpos-wrap.rtl").length?s+=`<div class="viwebpos-header-search-icon viwebpos-add-customer-wrap" data-position="bottom right" data-tooltip="${viwebpos.add_new_customer}">&#43;</div>`:s+=`<div class="viwebpos-header-search-icon viwebpos-add-customer-wrap" data-position="bottom left" data-tooltip="${viwebpos.add_new_customer}">&#43;</div>`,s+='<input type="text" class="viwebpos-search-input viwebpos-search-customer" placeholder="'+viwebpos.search_customer+'">',s+="</div>",e(".viwebpos-header-search-wrap").html(s)}if(!e(".viwebpos-customers-container").length){let s='<div class="viwebpos-container-element viwebpos-customers-container"><div class="viwebpos-customers-list-wrap">';s+='<div class="viwebpos-customers-list"></div></div><div class="viwebpos-customer-manage-wrap">',s+='<div class="viwebpos-customer-manage-header">'+viwebpos.add_new_customer+"</div>",s+='<form class="viwebpos-customer-manage-details">',s+='<div class="viwebpos-customer-col-2"><label>'+viwebpos.customer_first_name+'<input class="viwebpos-customer-fname" type="text" placeholder="Enter First Name" value=""></label><label>'+viwebpos.customer_last_name+'<input class="viwebpos-customer-lname" type="text" placeholder="Enter Last Name" value=""></label></div>',s+="<label>"+viwebpos.customer_email+'<input class="viwebpos-customer-email" type="text" placeholder="Enter Email" value=""></label>',s+="<label>"+viwebpos.customer_phone+'<input class="viwebpos-customer-phone" type="text" placeholder="Enter Phone" value=""></label>',s+="<label>"+viwebpos_text.customer_address1+'<input class="viwebpos-customer-address1" type="text" placeholder="Enter Address line 1" value=""></label>',s+="<label>"+viwebpos_text.customer_address2+'<input class="viwebpos-customer-address2" type="text" placeholder="Enter Address line 2" value=""></label>',s+='<div class="viwebpos-customer-col-2"><label>'+viwebpos.customer_country+'<select class="viwebpos-customer-country vi-ui fluid search dropdown">',s+='<option value="">'+viwebpos.customer_country_select+"</option>",e.each(viwebpos.wc_countries,(function(e,t){s+='<option value="'+e+'">'+t+"</option>"})),s+="</select></label><label>"+viwebpos.customer_state+'<input class="viwebpos-customer-state" type="text" placeholder="Enter State" value=""></label></div>',s+='<div class="viwebpos-customer-col-2"><label>'+viwebpos.customer_city+'<input class="viwebpos-customer-city" type="text" placeholder="Enter City" value=""></label><label>'+viwebpos.customer_postcode+'<input class="viwebpos-customer-postcode" type="number" placeholder="Enter Postcode" value=""></label></div>',s+='<button type="button" class="vi-ui button teal viwebpos-customer-submit"><span><i class="save outline icon"></i></span>'+viwebpos_text.save_title+"</button>",s+="</form>",s+="</div></div>",e(".viwebpos-container-wrap").append(s);let t=viwebpos_price.shop_address.country||"";e(".viwebpos-customer-country").off().dropdown("set selected",t),e(document.body).trigger("viwebpos_customer_state_init",[t,e(".viwebpos-customer-state"),'<input class="viwebpos-customer-state" type="text" placeholder="Enter State" value="">'])}if(location.search){let s=new URLSearchParams(location.search.substring(1));s=s.get("customer"),s?e(document.body).trigger("viwebpos_refresh_customers",[s,1,1,!1,"customer"]):e(document.body).trigger("viwebpos_refresh_customers")}else e(document.body).trigger("viwebpos_refresh_customers");setTimeout((function(){e(document.body).trigger("viwebpos-frontend-loaded",["customers"])}),100)})),e(document.body).on("viwebpos_refresh_customers",(function(t,i="",a=1,r=20,c=!1,n="customers"){s&&clearTimeout(s),s=setTimeout((function(s,t){let i=e(document.body).triggerHandler("viwebpos_search_data",[t,s,r,a]);e(".viwebpos-wrap").addClass("viwebpos-wrap-loading"),"function"==typeof i.then?i.then((function(t){t&&void 0!==t.id&&(setTimeout((function(s){e(document.body).trigger("viwebpos_customer_manage",[s])}),100,t),t=[t]),o(t,a,s,c)})):(i&&void 0!==i.id&&(setTimeout((function(s){e(document.body).trigger("viwebpos_customer_manage",[s])}),100,i),i=[i]),o(i,a,s,c))}),100,i,n)})),e(document).on("click",".viwebpos-search-customer-more",(function(s){s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();let t=e(".viwebpos-search-input.viwebpos-search-customer"),o=t.data("page")?t.data("page"):"",i=t.data("old_key")||"";if(!o)return!1;e(this).find(".button").addClass("loading"),e(document.body).trigger("viwebpos_refresh_customers",[i,o,void 0,!0])})),e(document).on("click keyup",".viwebpos-search-customer",(function(s){s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();let t=e(this),o=t.val();if(o===(t.data("old_key")||""))return!1;t.data("page",1),t.data("old_key",o),e(document.body).trigger("viwebpos_refresh_customers",[o])})),e(document).on("click",".viwebpos-search-customer-row",(function(s){s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation();e(this);let t=e(this).data("id"),o=e(".viwebpos-customer-manage-wrap").data("id")?e(".viwebpos-customer-manage-wrap").data("id"):"";if(!t)return!1;if(o&&o==t)return!1;let i=e(document.body).triggerHandler("viwebpos_search_data",["customer",t,21,1]);"function"==typeof i.then?i.then((function(s){e(document.body).trigger("viwebpos_customer_manage",[s])})):e(document.body).trigger("viwebpos_customer_manage",[i]),e(".viwebpos-customer-active").removeClass("viwebpos-customer-active"),e(".viwebpos-content-value-error").removeClass("viwebpos-content-value-error"),e(this).addClass("viwebpos-customer-active")})),e(document.body).on("viwebpos_customer_manage",(function(s,t){let o=e(".viwebpos-customer-manage-wrap");if(!t)return;let i=t.first_name+" "+t.last_name,a=o.find(".viwebpos-customer-fname"),r=o.find(".viwebpos-customer-lname"),c=o.find(".viwebpos-customer-email"),n=o.find(".viwebpos-customer-phone"),d=o.find(".viwebpos-customer-address1"),l=o.find(".viwebpos-customer-address2"),p=o.find(".viwebpos-customer-country"),u=o.find(".viwebpos-customer-state"),v=o.find(".viwebpos-customer-city"),m=o.find(".viwebpos-customer-postcode"),b=o.find(".viwebpos-customer-submit"),w=t.billing_address.state;viwebpos.wc_states[t.billing_address.country]&&viwebpos.wc_states[t.billing_address.country][w]&&(w=viwebpos.wc_states[t.billing_address.country][w]),o.data("id",t.id).data("username",t.username),o.find(".viwebpos-customer-manage-header").html(i),a.val(t.first_name).prop("disabled",!0).attr("placeholder",""),r.val(t.last_name).prop("disabled",!0).attr("placeholder",""),c.val(t.email).prop("disabled",!0).attr("placeholder",""),n.val(t.phone).prop("disabled",!0).attr("placeholder",""),d.val(t.billing_address.address_1).prop("disabled",!0).attr("placeholder",""),l.val(t.billing_address.address_2).prop("disabled",!0).attr("placeholder",""),p.addClass("disabled").dropdown("set selected",t.billing_address.country),u.replaceWith('<input class="viwebpos-customer-state" type="text" value="'+w+'" disabled />'),v.val(t.billing_address.city).prop("disabled",!0).attr("placeholder",""),m.val(t.billing_address.postcode).prop("disabled",!0).attr("placeholder",""),b.addClass("viwebpos-hidden")})),e(document).on("click",".viwebpos-customer-submit",(function(s){s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),e(document.body).trigger("villatheme_show_message_timeout",[e(".villatheme-show-message-message-customer-adding"),1]);let t=e(this).closest(".viwebpos-customer-manage-wrap");e(".viwebpos-content-value-error").removeClass("viwebpos-content-value-error");let o={first_name:t.find(".viwebpos-customer-fname"),last_name:t.find(".viwebpos-customer-lname"),email:t.find(".viwebpos-customer-email"),phone:t.find(".viwebpos-customer-phone"),address_1:t.find(".viwebpos-customer-address1"),postcode:t.find(".viwebpos-customer-postcode"),city:t.find(".viwebpos-customer-city"),state:t.find(".viwebpos-customer-state"),country:t.find(".viwebpos-customer-country")},i=e(document.body).triggerHandler("viwebpos_customer_fields_validate",[o,"viwebpos-content-value-error"]),a=[];if(i&&i.length)return e.each(i,(function(e,s){s&&a.push({message:s,status:["error","customer-adding"]})})),e(document.body).trigger("villatheme_show_messages",[a]),t.find(".viwebpos-content-value-error").eq(0).trigger("focus"),!1;e(".viwebpos-wrap").addClass("viwebpos-wrap-loading");let r={email:t.find(".viwebpos-customer-email").val()||"",first_name:t.find(".viwebpos-customer-fname").val()||"",last_name:t.find(".viwebpos-customer-lname").val()||"",billing_address:{address_1:t.find(".viwebpos-customer-address1").val(),address_2:t.find(".viwebpos-customer-address2").val(),city:t.find(".viwebpos-customer-city").val(),country:t.find(".viwebpos-customer-country").val(),state:t.find(".viwebpos-customer-state").val(),postcode:t.find(".viwebpos-customer-postcode").val(),phone:t.find(".viwebpos-customer-phone").val()||""}};t.find(".viwebpos-customer-country select").length&&(r.billing_address.country=t.find(".viwebpos-customer-country select").val()),t.find(".viwebpos-customer-state select").length&&(r.billing_address.state=t.find(".viwebpos-customer-state select").val()),e(document.body).trigger("viwebpos_add_new_customer",[r])})),e(document).on("click",".viwebpos-add-customer-wrap",(function(s){let t=e(".viwebpos-customer-manage-wrap"),o=t.find(".viwebpos-customer-state");if(!e(".viwebpos-search-customer-row").length)return t.find(".viwebpos-customer-fname").trigger("focus"),!1;e(".viwebpos-customer-active").removeClass("viwebpos-customer-active"),e(".viwebpos-customer-active").removeClass("viwebpos-customer-active"),t.data("id","").data("username",""),t.find(".viwebpos-customer-manage-header").html(viwebpos.add_new_customer),t.find(".viwebpos-customer-fname").val("").prop("disabled",!1).attr("placeholder","Enter First Name"),t.find(".viwebpos-customer-lname").val("").prop("disabled",!1).attr("placeholder","Enter Last Name"),t.find(".viwebpos-customer-email").val("").prop("disabled",!1).attr("placeholder","Enter Email"),t.find(".viwebpos-customer-phone").val("").prop("disabled",!1).attr("placeholder","Enter Phone Number"),t.find(".viwebpos-customer-address1").val("").prop("disabled",!1).attr("placeholder","Enter Address Line 1"),t.find(".viwebpos-customer-address2").val("").prop("disabled",!1).attr("placeholder","Enter Address Line 2"),t.find(".viwebpos-customer-country").val("").prop("disabled",!1),o.val("").prop("disabled",!1).attr("placeholder","Enter State"),t.find(".viwebpos-customer-city").val("").prop("disabled",!1).attr("placeholder","Enter City"),t.find(".viwebpos-customer-postcode").val("").prop("disabled",!1).attr("placeholder","Enter Postcode"),t.find(".viwebpos-customer-submit").removeClass("viwebpos-hidden"),t.find(".viwebpos-customer-fname").trigger("focus");let i=viwebpos_price.shop_address.country||"";e(".viwebpos-customer-country").removeClass("disabled").dropdown("set selected",i),e(document.body).trigger("viwebpos_customer_state_init",[i,o,'<input class="viwebpos-customer-state" type="text" placeholder="Enter State" value="">'])})),e(document).on("change",".viwebpos-customer-country select",(function(s){if(e(this).closest(".dropdown.disabled").length)return!1;let t=e(".viwebpos-customer-state");e(document.body).trigger("viwebpos_customer_state_init",[e(this).val(),t,'<input class="viwebpos-customer-state" type="text" placeholder="Enter State" value="">'])}))}));