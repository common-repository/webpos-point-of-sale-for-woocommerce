jQuery(document).ready((function(){"use strict";let t;jQuery(document).on("click",".viwebpos-add-transaction-wrap",(function(){jQuery(".viwebpos-popup-wrap-add-transaction").removeClass("viwebpos-popup-wrap-hidden").addClass("viwebpos-popup-wrap-show"),jQuery(".viwebpos-popup-wrap-add-transaction").find(".viwebpos-popup-bt-loading").removeClass("viwebpos-popup-bt-loading"),jQuery(".viwebpos-popup-wrap-add-transaction").find("#viwebpos-popup-content-add-transaction-type-in").prop("checked",!0),jQuery(".viwebpos-popup-wrap-add-transaction").find("textarea").val(""),jQuery(".viwebpos-popup-wrap-add-transaction").find('[name="add_transaction_value"]').val("").trigger("focus")})),jQuery(document).on("click",".viwebpos-popup-bt-add-transaction:not(.viwebpos-popup-bt-loading)",(function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let e=jQuery(this).closest(".viwebpos-popup-wrap-add-transaction"),a=jQuery(this);if(jQuery(document.body).trigger("villatheme_show_message_timeout",[jQuery(".villatheme-show-message-message-transaction-adding"),1]),e.addClass("viwebpos-popup-wrap-loading").find(".viwebpos-popup-content-value-error").removeClass("viwebpos-popup-content-value-error"),a.addClass("viwebpos-popup-bt-loading"),!e.find(".viwebpos-price-input-value").val())return jQuery(document.body).trigger("villatheme_show_message",[viwebpos.transaction_add_price_empty,["error","transaction-adding"],"",!1,4500]),e.find(".viwebpos-price-input-wrap").addClass("viwebpos-popup-content-value-error"),e.find(".viwebpos-price-input-value").trigger("focus"),!1;let o={cashier_id:viwebpos.cashier_id,currency:viwebpos.wc_currency,currency_symbol:viwebpos.wc_currency_symbol,note:e.find(".viwebpos-popup-content-add-transaction-reason-value").val()||""};o[jQuery('[name="new-transaction-type"]').filter(":checked").eq(0).val()||"in"]=e.find(".viwebpos-price-input-value").val(),jQuery(document.body).trigger("viwebpos_add_new_transaction",[o])})),jQuery(document).on("click",".viwebpos-transactions-nav-bt:not(.loading):not(.viwebpos-hidden)",(function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let e=jQuery(".viwebpos-transactions-max-page").val()?jQuery(".viwebpos-transactions-max-page").val().split("|"):[],a=(jQuery(this).data("page")||"").toString(),o=jQuery(this).data("key")||"";return!(!a||-1===e.indexOf(a))&&(jQuery(this).addClass("loading"),e.indexOf(a)<e.length-1&&jQuery(".viwebpos-transaction-wrap-"+a).length?(jQuery(document.body).trigger("viwebpos_transactions_get_html",["",a,o,!0]),!1):void jQuery(document.body).trigger("viwebpos_transactions_refresh_html",[o,a]))})),jQuery(document).on("click keyup",".viwebpos-search-transaction",(function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let e=jQuery(this),a=e.val();if(a===(e.data("old_key")||""))return!1;e.data("old_key",a),jQuery(document.body).trigger("viwebpos_transactions_refresh_html",[a])})),jQuery(document.body).on("viwebpos-transactions-load",(function(){if(!jQuery(".viwebpos-header-search-transaction").length){let t='<div class="viwebpos-header-search viwebpos-header-search-transaction">';jQuery(".viwebpos-wrap.rtl").length?t+=`<div class="viwebpos-header-search-icon viwebpos-add-transaction-wrap" data-position="bottom right" data-tooltip="${viwebpos.transaction_add_title}">&#43;</div>`:t+=`<div class="viwebpos-header-search-icon viwebpos-add-transaction-wrap" data-position="bottom left" data-tooltip="${viwebpos.transaction_add_title}">&#43;</div>`,t+='<input type="text" class="viwebpos-search-input viwebpos-search-transaction" placeholder="'+viwebpos.search_transaction+'">',t+="</div>",jQuery(".viwebpos-header-search-wrap").html(t)}if(jQuery(".viwebpos-popup-wrap-add-transaction").length||jQuery(document.body).trigger("viwebpos_get_popup_wrap",["add-transaction"]),!jQuery(".viwebpos-transactions-container").length){let t='<div class="viwebpos-container-element viwebpos-transactions-container"><div class="viwebpos-transactions-contents-container">';t+='<table class="vi-ui striped table viwebpos-transactions-wrap">',t+="<thead><tr>",t+="<th>"+viwebpos.transaction_table_title_id+"</th>",t+="<th>"+viwebpos.transaction_table_title_order+"</th>",t+="<th>"+viwebpos.transaction_table_title_in+"</th>",t+="<th>"+viwebpos.transaction_table_title_out+"</th>",t+="<th>"+viwebpos.transaction_table_title_method+"</th>",t+="<th>"+viwebpos.transaction_table_title_note+"</th>",t+="<th>"+viwebpos.transaction_table_title_date+"</th>",t+="</tr></thead>",t+="<tbody></tbody>",t+='<tfoot><tr><th colspan="7"><input type="hidden" class="viwebpos-transactions-max-page" value="">',t+='<span class="vi-ui small button viwebpos-transactions-nav-bt viwebpos-transactions-nav-bt-prev">Prev</span>',t+='<span class="vi-ui small button viwebpos-transactions-nav-bt viwebpos-transactions-nav-bt-next">Next</span></th></tr></tfoot>',t+="</table></div></div>",jQuery(".viwebpos-container-wrap").prepend(t)}jQuery(document.body).trigger("viwebpos_transactions_refresh_html")})),jQuery(document.body).on("viwebpos_transactions_refresh_html",(function(e,a="",o=1,n=15){t&&clearTimeout(t),1===o&&jQuery(".viwebpos-transactions-max-page").val(null),t=setTimeout((function(t){let e=jQuery(document.body).triggerHandler("viwebpos_search_data",["transactions",t,n,o]);"function"==typeof e.then?e.then((function(e){jQuery(document.body).trigger("viwebpos_transactions_get_html",[e,o,t])})):jQuery(document.body).trigger("viwebpos_transactions_get_html",[e,o,t])}),10,a)})),jQuery(document.body).on("viwebpos_transactions_get_html",(function(t,e,a=1,o="",n=!1){jQuery(".viwebpos-wrap").removeClass("viwebpos-wrap-loading");let i=jQuery(".viwebpos-transactions-wrap");a=a.toString();let s,r,p=i.find(".viwebpos-transactions-max-page").val()?i.find(".viwebpos-transactions-max-page").val().split("|"):[],d=0;if(r=p.indexOf(a)>-1?p[p.indexOf(a)-1]||0:p[p.length-1],jQuery(".viwebpos-popup-wrap-show").length&&jQuery(document.body).trigger("viwebpos_popup_close"),i.removeClass("viwebpos-transactions-wrap-empty viwebpos-transactions-wrap-one-page"),i.find(".viwebpos-transactions-nav-bt, .viwebpos-transaction-wrap").addClass("viwebpos-hidden"),i.find(".viwebpos-transactions-nav-bt").removeClass("loading"),"1"!==a||n||i.find("tbody").html(null),a&&n&&!e&&i.find(".viwebpos-transaction-wrap-"+a).length)return i.find(".viwebpos-transaction-wrap-"+a).removeClass("viwebpos-hidden"),p.indexOf(a)<p.length-1&&(s=p[p.indexOf(a)+1]||""),s&&i.find(".viwebpos-transactions-nav-bt-next").data({page:s,key:o}).removeClass("viwebpos-hidden"),r&&i.find(".viwebpos-transactions-nav-bt-prev").data({page:r,key:o}).removeClass("viwebpos-hidden"),!1;e.length&&e.at(-1).next_page&&(s=e.at(-1).next_page,e.pop()),jQuery.each(e,(function(t,e){if(!e.id||!e.cashier_id||!e.in&&!e.out)return!0;d++;let o=e.currency_symbol||null,n='<tr class="viwebpos-transaction-wrap viwebpos-transaction-wrap-'+a+'">';n+="<td>#"+e.id+"</td>",e.order_id?n+="<td>#"+e.order_id+"</td>":n+="<td>-</td>",n+="<td>"+viwebpos_get_price_html(e.in,null,null,null,null,o)+"</td>",n+="<td>"+viwebpos_get_price_html(e.out,null,null,null,null,o)+"</td>","viwebpos_manual"===e.method?n+="<td>Manual</td>":viwebpos.viwebpos_payments&&viwebpos.viwebpos_payments[e.method]&&viwebpos.viwebpos_payments[e.method].title?n+="<td>"+viwebpos.viwebpos_payments[e.method].title+"</td>":n+="<td>"+(e.method??"")+"</td>",e.note?n+="<td>"+e.note+"</td>":n+="<td>-</td>",n+="<td>"+e.create_at||"-</td>",n+="</tr>",i.find("tbody").append(n)})),d?s||r||i.addClass("viwebpos-transactions-wrap-one-page"):i.addClass("viwebpos-transactions-wrap-one-page viwebpos-transactions-wrap-empty").find("tbody").html('<tr class="viwebpos-search-transaction-empty"><td colspan="7" class="viwebpos-search-transaction-empty"> '+(viwebpos.search_transaction_empty||"No transaction found")+"</td></tr>"),s&&(-1===p.indexOf(a)&&p.push(a),-1===p.indexOf(s)&&p.push(s.toString()),i.find(".viwebpos-transactions-max-page").val(p.join("|").trim()),i.find(".viwebpos-transactions-nav-bt-next").data({page:s,key:o}).removeClass("viwebpos-hidden")),r&&i.find(".viwebpos-transactions-nav-bt-prev").data({page:r,key:o}).removeClass("viwebpos-hidden")}))}));