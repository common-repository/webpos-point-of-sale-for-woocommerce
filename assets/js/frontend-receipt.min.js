jQuery((function(e){"use strict";"undefined"!=typeof viwebpos_receipts&&(e(document.body).on("viwebpos-bill-of-sale-load",(function(){e(".viwebpos-popup-wrap-print-receipt").length||e(document.body).trigger("viwebpos_get_popup_wrap",["print-receipt"])})),e(document).on("viwebpos-frame-print",(function(){if(!e("#viwebpos-frame-print").length)return e(".viwebpos-wrap").removeClass("viwebpos-wrap-loading viwebpos-wrap-loading1"),!1;e("#viwebpos-frame-print").css("left","0"),window.frames["viwebpos-frame-print"].onload=function(){window.frames["viwebpos-frame-print"].focus(),window.frames["viwebpos-frame-print"].print(),e("#viwebpos-frame-print").css("left","100%"),e(".viwebpos-order-print").removeClass("loading"),e(".viwebpos-wrap").removeClass("viwebpos-wrap-loading viwebpos-wrap-loading1"),e(".viwebpos-popup-wrap-show").length&&e(document.body).trigger("viwebpos_popup_close")}})),e(document.body).on("viwebpos_print_receipt",(function(o,i,t=null,r=""){if(!parseInt(i))return e(document.body).trigger("villatheme_show_message",[viwebpos.not_found_order_to_print.toString().replace("{order_id}",i),["error","print-receipt"],"",!1,4500]),!1;e(".viwebpos-wrap").addClass("viwebpos-wrap-loading1");(async function(){let o=!1;return await new Promise((function(t){e.ajax({url:viwebpos.admin_ajax_url,type:"GET",data:{action:"viwebpos_print_order",order_ids:i,receipt_template:r},beforeSend:function(){e(".viwebpos-wrap").addClass("viwebpos-wrap-loading")},success:function(i){if(i.messages&&e(document.body).trigger("villatheme_show_message",[i.messages,[i.status,"print-receipt"],"",!1,4500]),"success"===i.status&&i.html){e("#viwebpos-frame-print").remove(),e("body").append('<iframe id="viwebpos-frame-print" name="viwebpos-frame-print"></iframe>');let o=window.frames["viwebpos-frame-print"];o.document.write(i.html),o.document.close()}else o=!0;t(o)},error:function(i){console.log(i),e(document.body).trigger("villatheme_show_message",[i.statusText,["error","print-receipt"],"-1"===i.responseText?"":i.responseText,!1,4500]),t(o)}})})),o})().then((function(o){o&&(e(document.body).trigger("villatheme_show_message",[viwebpos_text.error_print_receipt,["error","print-receipt"],"",!1,4500]),e(".viwebpos-popup-wrap-show").length&&e(document.body).trigger("viwebpos_popup_close")),e(document).trigger("viwebpos-frame-print")}))})),e(document.body).on("viwebpos_set_auto_print_receipt_after_checkout",(function(o,i=!0){if("undefined"==typeof viwebpos_data||!viwebpos_data)return;let t=viwebpos_data;t.viwebposDB||(t.viwebposDB=indexedDB.open("viwebposDB"));let r=t.viwebposDB.result;t.auto_print_receipt=i?1:"",t.put(r.transaction("settings","readwrite").objectStore("settings"),t.auto_print_receipt,"auto_print_receipt"),t.auto_print_receipt?e(".viwebpos-header-action-icons-auto_print").removeClass("viwebpos-header-action-icons-auto_print-disable"):e(".viwebpos-header-action-icons-auto_print").addClass("viwebpos-header-action-icons-auto_print-disable")})))}));