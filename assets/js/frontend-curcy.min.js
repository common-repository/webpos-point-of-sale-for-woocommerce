jQuery(document).ready((function(e){"use strict";"undefined"!=typeof viwebpos_curcy&&("undefined"!=typeof _woocommerce_multi_currency_params&&(_woocommerce_multi_currency_params.do_not_reload_page=1,_woocommerce_multi_currency_params.switch_by_js=1),e(document.body).on("viwebpos-get-current-url",(function(c,r,t){if(!e(r).length||!e(r).closest(".viwebpos-curcy-header-right").length)return t;let i=viwebpos.wc_currency;if(e(r).data("currency")?i=e(r).data("currency"):t.includes("wmc-currency=")&&(i=t.split("wmc-currency=")[1]),viwebpos.wc_currency!=i){viwebpos_data.current_cart.curcy_currency=i,viwebpos.wc_currency=i,async function(){await viwebpos_data.cart_calculate_totals([],!1),await viwebpos_data.refresh_cart(!1)}().then((function(){location.reload()}))}return""})),e(document.body).on("wmc_cache_compatible_finish",(function(c,r){viwebpos_data.current_cart.curcy_currency=r.current_currency,viwebpos.wc_currency=r.current_currency,viwebpos_curcy.widget=r.shortcodes[0],e(document.body).trigger("viwebpos-frontend-load")})),e(document.body).on("viwebpos_curcy_enable",(function(e,c=!1){return c?viwebpos_curcy.enable&&("undefined"==typeof viwebpos_redis||!viwebpos_redis.pd_enable&&!viwebpos_redis.cart_enable):viwebpos_curcy.enable})),e(document.body).on("viwebpos-bill-of-sale-refresh-bill-tabs",(function(){viwebpos_data.current_cart.curcy_currency||(viwebpos_data.current_cart.curcy_currency=viwebpos.wc_currency_default);let c=viwebpos_data.current_cart.curcy_currency;if(c===viwebpos.wc_currency&&e(`.viwebpos-checkout-form-content-paid-input_${c}`).length)return;viwebpos.wc_currency=c,viwebpos_price.wc_currency_symbol=viwebpos_curcy.currencies[c].symbol,viwebpos_price.wc_get_price_decimals=viwebpos_curcy.currencies[c].decimals,viwebpos_price.wc_price_format=viwebpos_curcy.currencies[c].pos;let r=viwebpos_price.wc_price_format.toString().replace("%1$s",`<span class="viwebpos-currency-symbol">${viwebpos_price.wc_currency_symbol}</span>`);e(".viwebpos-checkout-form-content-wrap-total .viwebpos-checkout-form-content-paid-input").parent().html(r.replace("%2$s",`<input type="text" value="" class="viwebpos-checkout-form-content-paid-input viwebpos-checkout-form-content-paid-input_${c}">`)),e(".viwebpos-checkout-form-content-wrap-payment .viwebpos-checkout-form-content-paid-input.viwebpos-checkout-form-content-amount-input").parent().html(r.replace("%2$s",'<input type="text" value="" class="viwebpos-checkout-form-content-amount-input viwebpos-checkout-form-content-paid-input">')),e(".viwebpos-checkout-form-content-wrap-coupon .viwebpos-currency-symbol").html(viwebpos_price.wc_currency_symbol),e(".viwebpos-checkout-form-content-wrap-shipping .viwebpos-checkout-shipping-amount").replaceWith(`<input type="number" step="${1/Math.pow(10,viwebpos_price.wc_get_price_decimals)}" class="viwebpos-checkout-shipping-amount" placeholder="${viwebpos_price.wc_currency_symbol}" value="">`);let t='<select class="viwebpos-checkout-add-discount-type vi-ui dropdown">';t+=`<option  value="1" >${viwebpos_text.discount_fixed_title.replace("%1$s",viwebpos_price.wc_currency_symbol)}</option>`,t+=`<option  value="0">${viwebpos_text.discount_percentage_title}</option>`,t+="</select>",e(".viwebpos-checkout-form-content-wrap-coupon .viwebpos-checkout-add-discount-type").replaceWith(t),e(".viwebpos-checkout-add-discount-type").off().dropdown()})),e(document.body).on("viwebpos_redis_get_cart_items",(function(e,c,r){return void 0!==r.payments&&void 0!==viwebpos_data.current_cart.payments&&(viwebpos_data.current_cart.curcy_old_payments_paid=viwebpos_data.current_cart.curcy_old_payments_paid||viwebpos_data.current_cart.payments.paid,viwebpos_data.current_cart.payments.paid=r.payments),c})),e(document.body).on("viwebpos_redis_get_discount_data",(function(e,c){return viwebpos_data.current_cart.curcy_currency?c.current_currency=viwebpos_data.current_cart.curcy_currency:void 0!==viwebpos_data.current_cart.order_data&&viwebpos_data.current_cart.order_data.currency?c.current_currency=viwebpos_data.current_cart.order_data.currency:c.current_currency=viwebpos.wc_currency_default,c.current_currency&&(viwebpos.wc_currency=c.current_currency,viwebpos_price.wc_currency_symbol=viwebpos_curcy.currencies[c.current_currency].symbol,viwebpos_price.wc_get_price_decimals=viwebpos_curcy.currencies[c.current_currency].decimals,viwebpos_price.wc_price_format=viwebpos_curcy.currencies[c.current_currency].pos),void 0!==viwebpos_data.current_cart.payments&&viwebpos_data.current_cart.payments.is_paid&&(void 0!==viwebpos_data.current_cart.curcy_old_payments_paid&&(viwebpos_data.current_cart.payments.paid=viwebpos_data.current_cart.curcy_old_payments_paid),c.payments=viwebpos_data.current_cart.payments.paid),c})),e(document.body).on("viwebpos_get_data_products",(function(c,r,t,i,o,_,p){if(!e(document.body).triggerHandler("viwebpos_curcy_enable"))return r;let a=viwebpos_data.is_online;if(!r.length)return r;let n=viwebpos_data.current_cart.curcy_currency||viwebpos.wc_currency,u=viwebpos_data.current_cart;if(!a||!viwebpos_curcy.fix_price_enable&&viwebpos.wc_currency_default===n)return viwebpos.wc_currency=viwebpos.wc_currency_default,viwebpos_price.wc_currency_symbol=viwebpos.wc_currency_symbol_default,viwebpos_price.wc_get_price_decimals=viwebpos.wc_get_price_decimals_default,viwebpos_price.wc_price_format=viwebpos.wc_price_format_default,viwebpos_data.current_cart.curcy_currency=viwebpos.wc_currency,r;viwebpos.wc_currency=n,viwebpos_price.wc_currency_symbol=viwebpos_curcy.currencies[n].symbol,viwebpos_price.wc_get_price_decimals=viwebpos_curcy.currencies[n].decimals,viwebpos_price.wc_price_format=viwebpos_curcy.currencies[n].pos;return async function(){let c={},a=[];if(e.each(r,(function(e,r){if(!r.id)return!0;c[r.id]=r,a.push(r.id)})),!a.length)return r;let s=[];return e.each(u.cart_contents,(function(e,c){if(!c.product_id||!c.data)return!0;s.push({product_id:c.product_id,variation_id:c.variation_id,quantity:c.quantity,cart_item_key:e,price:c.data.price,only_convert:viwebpos.cart_change_pd_price&&void 0!==c.price||"custom"===c.product_id})})),await new Promise((function(r){let d={data:a,cart_data:s,cart_id:u.id,customer_id:u.customer&&u.customer.id||"",coupons:u.applied_coupons?Object.keys(u.applied_coupons):"",shipping_address:u.shipping&&Object.keys(u.shipping).length&&u.pos_shipping_address?u.pos_shipping_address:"",current_currency:n,viwebpos_nonce:viwebpos.nonce};d=e(document.body).triggerHandler("viwebpos_cury_get_price_data",d)||d,e.ajax({type:"post",url:viwebpos.viwebpos_ajax_url.toString().replace("%%endpoint%%","viwebpos_cury_get_price"),data:d,success:function(a){"success"===a.status&&e.each(a.pd_price,(function(e,r){e&&c[e]&&(c[e].curcy_old_price=c[e].curcy_old_price||c[e].price,c[e].curcy_old_regular_price=c[e].curcy_old_regular_price||c[e].regular_price,c[e].price=r.price,c[e].regular_price=r.regular_price)})),c=e(document.body).triggerHandler("viwebpos_cury_get_data_products",[c,a,t,i,o,_,p])||c,r(c)},error:function(e){console.log(e),r(c)}})})),Object.keys(c).length&&e.map(r,(function(e,t){if(!t.id)return!0;void 0!==c[t.id]&&(r[e]=c[t.id])})),r}()})),e(document.body).on("viwebpos_refresh_cart",(function(e){viwebpos_curcy.is_update_current_cart&&viwebpos_data.is_update_current_cart&&(viwebpos_data.is_update_current_cart=!1,viwebpos_curcy.is_update_current_cart=!1)})),e(document.body).on("viwebpos_curcy_before_calculate_totals",(function(c,r){if(!e(document.body).triggerHandler("viwebpos_curcy_enable",!0))return r;viwebpos_data.is_update_current_cart=!0,viwebpos_curcy.is_update_current_cart=!0;let t=r.cart_contents;if(!Object.keys(t).length)return r.curcy=0,r;if(void 0!==r.curcy&&parseInt(r.curcy)&&(e.each(r.cart_contents,(function(e,c){return!c.product_id||!c.data||(void 0===c.data.curcy_old_price||void 0===c.data.curcy_old_regular_price?(r.curcy=0,!1):void 0)})),parseInt(r.curcy)))return r;r.curcy_currency||(r.curcy_currency=viwebpos_data.current_cart.curcy_currency||viwebpos.wc_currency);let i=r.curcy_currency;if(e.each(r.cart_contents,(function(e,c){if(!c.product_id||!c.data)return!0;void 0!==c.curcy_old_price&&(t[e].price=c.curcy_old_price),void 0!==c.data.curcy_old_price&&(t[e].data.price=c.data.curcy_old_price),void 0!==c.data.curcy_old_regular_price&&(t[e].data.regular_price=c.data.curcy_old_regular_price)})),r.cart_contents=t,!viwebpos_curcy.fix_price_enable&&viwebpos.wc_currency_default===i)return viwebpos.wc_currency=viwebpos.wc_currency_default,viwebpos_price.wc_currency_symbol=viwebpos.wc_currency_symbol_default,viwebpos_price.wc_get_price_decimals=viwebpos.wc_get_price_decimals_default,viwebpos_price.wc_price_format=viwebpos.wc_price_format_default,viwebpos_data.current_cart.curcy_currency=viwebpos.wc_currency,r;viwebpos.wc_currency=i,viwebpos_price.wc_currency_symbol=viwebpos_curcy.currencies[i].symbol,viwebpos_price.wc_get_price_decimals=viwebpos_curcy.currencies[i].decimals,viwebpos_price.wc_price_format=viwebpos_curcy.currencies[i].pos,r.curcy=1;return async function(){let c=[];return e.each(r.cart_contents,(function(e,r){if(!r.product_id||!r.data)return!0;let t={product_id:r.product_id,variation_id:r.variation_id,quantity:r.quantity,cart_item_key:e};viwebpos.cart_change_pd_price&&void 0!==r.price?(t.only_convert=1,t.price=r.price):"custom"===r.product_id?(t.only_convert=1,t.price=r.data.price):(t.only_convert="",t.price=r.data.price),c.push(t)})),await new Promise((function(o){let _={data:c,cart_id:r.id,customer_id:r.customer&&r.customer.id||"",coupons:r.applied_coupons?Object.keys(r.applied_coupons):"",shipping_address:r.shipping&&Object.keys(r.shipping).length&&r.pos_shipping_address?r.pos_shipping_address:"",current_currency:i,viwebpos_nonce:viwebpos.nonce};void 0!==viwebpos_data.current_cart.payments&&viwebpos_data.current_cart.payments.is_paid&&(void 0!==viwebpos_data.current_cart.curcy_old_payments_paid&&(viwebpos_data.current_cart.payments.paid=viwebpos_data.current_cart.curcy_old_payments_paid),_.payments=viwebpos_data.current_cart.payments.paid),_=e(document.body).triggerHandler("viwebpos_cury_cart_item_price_data",_)||_,e.ajax({type:"post",url:viwebpos.viwebpos_ajax_url.toString().replace("%%endpoint%%","viwebpos_cury_cart_item_price"),data:_,success:function(c){"success"===c.status&&(e.each(c.pd_price,(function(e,c){e&&t[e]&&t[e].data&&(c.only_convert&&(t[e].curcy_old_price=t[e].curcy_old_price||t[e].price,t[e].price=c.price),t[e].data.curcy_old_price=t[e].data.curcy_old_price||t[e].data.price,t[e].data.curcy_old_regular_price=t[e].data.curcy_old_regular_price||t[e].data.regular_price,t[e].data.price=c.price,t[e].data.regular_price=c.regular_price||t[e].data.curcy_old_regular_price)})),void 0!==c.payments&&void 0!==viwebpos_data.current_cart.payments&&(viwebpos_data.current_cart.curcy_old_payments_paid=viwebpos_data.current_cart.curcy_old_payments_paid||viwebpos_data.current_cart.payments.paid,viwebpos_data.current_cart.payments.paid=c.payments)),t=e(document.body).triggerHandler("viwebpos_cury_get_cart_items",[t,c])||t,o(t)},error:function(e){console.log(e),o(t)}})})),r.cart_contents=t,r}()})),e(document.body).on("viwebpos_set_cart_after_created_order",(function(e,c){return viwebpos.wc_currency=viwebpos.wc_currency_default,viwebpos_price.wc_currency_symbol=viwebpos.wc_currency_symbol_default,viwebpos_price.wc_get_price_decimals=viwebpos.wc_get_price_decimals_default,viwebpos_price.wc_price_format=viwebpos.wc_price_format_default,c.curcy_currency=viwebpos.wc_currency,c})),e(document.body).on("viwebpos-frontend-before-load",(function(c,r=""){if(e(".viwebpos-curcy-header-right-wrap").removeClass("viwebpos-curcy-header-right-wrap").find(".viwebpos-curcy-header-right").remove(),!viwebpos_curcy.enable)return!1;-1===["orders","transactions","customers","tables"].indexOf(r)?e(".viwebpos-header-right-wrap").addClass("viwebpos-curcy-header-right-wrap").prepend(`<div class="viwebpos-curcy-header-right">${viwebpos_curcy.widget}</div>`):(viwebpos.wc_currency=viwebpos.wc_currency_default,viwebpos_price.wc_currency_symbol=viwebpos.wc_currency_symbol_default,viwebpos_price.wc_get_price_decimals=viwebpos.wc_get_price_decimals_default,viwebpos_price.wc_price_format=viwebpos.wc_price_format_default)})),e(document).on("viwebpos_get_price_html_decimals",(function(c,r,t){if("undefined"==typeof viwebpos_curcy||!t)return r;let i=viwebpos_curcy.currencies;return i&&Object.keys(i).length?(e.each(i,(function(e,c){if(void 0!==c.symbol&&c.symbol===t)return r=c.decimals?c.decimals:0,!1})),r):r})),e(document).on("viwebpos_get_price_html_format",(function(c,r,t){if("undefined"==typeof viwebpos_curcy||!t)return r;let i=viwebpos_curcy.currencies;return i&&Object.keys(i).length?(e.each(i,(function(e,c){if(void 0!==c.symbol&&c.symbol===t)return r=c.pos||r,!1})),r):r})))}));